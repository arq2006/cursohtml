<!doctype html>
<html>
    <head>
        <title>Curso Javascript Completo 2018</title>
        <meta charset="utf-8">
        
        
    </head>
    <body>
        <h1>Curso Javascript Completo 2018</h1> 

        <input type="text" id="cronometro">
        <button id="iniciar">Iniciar</button>
        <button id="pausar">Pausar</button>
        <button id="parar">Parar</button>

        <script>          
        
        (function(){
            var $cronometro = document.querySelector('#cronometro');
            var $iniciar = document.querySelector('#iniciar');
            var $pausar = document.querySelector('#pausar');
            var $parar = document.querySelector('#parar');

            $iniciar.addEventListener('click', iniciar);
            $pausar.addEventListener('click', pausar);
            $parar.addEventListener('click', parar);
            
            var intervalo = null;
            var msClickIniciar = 0
            var msClickPausar = 0
            var mstempoDecorrido = 0
            var rodando = false;
            
            function iniciar(){
                if(rodando) return;
                msClickIniciar = Date.now();
                iniciarCronometro(); 
                rodando = true;
            }
            
            function pausar(){
                if($cronometro.value) 
                if(rodando){
                    clearInterval(intervalo);
                    msClickPausar = Date.now();
                    mstempoDecorrido += (msClickPausar - msClickIniciar);
                } else {
                    msClickIniciar = Date.now();
                    iniciarCronometro(mstempoDecorrido);
                }
                rodando = !rodando;
            }
            
            function parar(){
                msClickPausar = 0;
                msClickIniciar = 0;
                rodando = false;
                clearInterval(intervalo);
                $cronometro.value = '';
            }
            
            function iniciarCronometro(tempoDecorrido){
                var _ms = tempoDecorrido || 0;
                intervalo = setInterval(function(){
                    var msAgora = Date.now();
                    var diferenca = msAgora - msClickIniciar;
                    $cronometro.value = formataMs(diferenca + _ms);
                }, 100)
            }
            
            function formataMs(ms){

                const   MINUTO = 60 * 1000;

                if(ms < 1000){
                    return ms;
                } else if(ms < MINUTO){
                    var s = ms/1000;
                    s = parseInt(s);
                    var c = ms - ( s * 1000);
                    return s + ':' + c;
                } else {
                    var m = ms / MINUTO; 
                    m = parseInt(m);

                    return m + ":" + formataMs( ms - m * MINUTO )
                    // var s = ms / 1000 - ( m * 60);
                    // s = parseInt(s);
                    // var c = ms - (s * 1000) - (m * MINUTO );
                    // return m + ':' + s + ':' + c;
                }
                
            }
        })();
        // var timestampClickIniciar = 0;
    
        
        // function iniciarCronometro(){
        //     setInterval(function(){
        //         var timestampAgora = Date.now();
        //         var diferenca = timestampAgora - timestampClickIniciar;
        //         $cronometro.value = diferenca;
        //     }, 100)
        // }
        </script>
    </body>
    </html>